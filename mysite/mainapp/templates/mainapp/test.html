<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <title>å»æ‰€åœ°åœ–</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>è¡›æ•™</title>

    <!-- Favicons -->
    <link href="/static/mainapp/images/icon.png" rel="icon">
    <link href="/static/mainapp/images/icon.png" rel="apple-touch-icon">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Vendor CSS Files -->
    <link href="/static/mainapp/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css" rel="stylesheet">

    <!-- Main CSS File -->
    <link href="/static/mainapp/css/main.css" rel="stylesheet">
    <script type="module"
        src="https://ajax.googleapis.com/ajax/libs/@googlemaps/extended-component-library/0.6.11/index.min.js"></script>
    <style>
        #calendar {
            margin: 0 auto;
            max-width: 900px;
            background-color: #ffffff;
            border-radius: 6px;
            box-shadow: 0 1px 2px #c3c3c3;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            padding: 20px;
        }

        :root {
            --toilet-color: #0288D1;
        }

        .property {
            align-items: center;
            background-color: #FFFFFF;
            border-radius: 50%;
            color: #263238;
            display: flex;
            font-size: 14px;
            gap: 15px;
            height: 40px;
            /* Increased height */
            justify-content: center;
            padding: 4px;
            position: relative;
            transition: all 0.3s ease-out;
            width: 40px;
            /* Increased width */
            border: 2px solid var(--toilet-color);
            /* Added a border */
        }

        .property::after {
            border-left: 9px solid transparent;
            border-right: 9px solid transparent;
            border-top: 9px solid #FFFFFF;
            content: "";
            height: 0;
            left: 50%;
            position: absolute;
            top: 95%;
            transform: translate(-50%, 0);
            transition: all 0.3s ease-out;
            width: 0;
            z-index: 1;
            display: none;
            /* Hide the arrow */
        }

        .property .icon {
            align-items: center;
            display: flex;
            justify-content: center;
            color: var(--toilet-color);
            /* Toilet icon color */
            font-size: 20px;
            /* Increased icon size */
        }

        .property .details {
            display: none;
            flex-direction: column;
            flex: 1;
        }

        .property .address {
            color: #9E9E9E;
            font-size: 10px;
            margin-bottom: 10px;
            margin-top: 5px;
        }

        .property .features {
            align-items: flex-end;
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        .property .features>div {
            align-items: center;
            background: #F5F5F5;
            border-radius: 5px;
            border: 1px solid #ccc;
            display: flex;
            font-size: 10px;
            gap: 5px;
            padding: 5px;
        }

        .highlight {
            background-color: #FFC107 !important;
        }

        /* Style for the user's current location */
        .user-location {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: rgba(255, 165, 0, 0.5);
            /* Soft orange with transparency */
            border: 2px solid rgba(255, 165, 0, 0.8);
            /* Slightly darker border */
            position: relative;
        }

        .user-location::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 6px;
            height: 6px;
            background-color: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body>
    <header id="header" class="header d-flex align-items-center fixed-top">
        <div class="container-fluid container-xl d-flex align-items-center">
            <a href="index.html" class="logo d-flex align-items-center me-auto">
                <img src="images/icon.png" alt="">
                <h1 class="sitename">PooPalooza</h1>
            </a>
            <nav id="navmenu" class="navmenu">
                <ul>
                    <li><a href="index.html#hero" class="active">ä¸»é </a></li>
                    <li class="dropdown">
                        <a href="#"><span>åŠŸèƒ½</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                        <ul>
                            <li><a href="#map">å»æ‰€åœ°åœ–</a></li>
                            <li><a href="#education">è¡›æ•™</a></li>
                            <li><a href="#aboutus">é—œæ–¼æˆ‘å€‘</a></li>
                        </ul>
                    </li>
                </ul>
                <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
            </nav>
            <a class="btn-getstarted" href="#login">ç™»å…¥</a>
            <a class="btn-getstarted" href="#register">è¨»å†Š</a>
        </div>
    </header>

    <div class="main-content">
        <div id="map-container">
            <div id="map" style="height: 500px; width: 100%;"></div>
        </div>
    </div>

    <script>
        async function initMap() {
            const {
                Map
            } = await google.maps.importLibrary("maps");
            const {
                AdvancedMarkerElement
            } = await google.maps.importLibrary("marker");
            const {
                PlacesService
            } = await google.maps.importLibrary("places");
            const map = new Map(document.getElementById("map"), {
                zoom: 15,
                center: {
                    lat: 37.43238031167444,
                    lng: -122.16795397128632
                }, // Set a default center
                mapId: "4504f8b37365c3d0",
            });

            // ç¯„ä¾‹å»æ‰€ä½ç½®è³‡æ–™
            const toiletLocations = [{
                address: '215 Emily St, MountainView, CA',
                description: 'ä¹¾æ·¨çš„å»æ‰€',
                price: 'å…è²»',
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                position: {
                    lat: 37.50024109655184,
                    lng: -122.28528451834352
                }
            }, {
                address: '108 Squirrel Ln, Menlo Park, CA',
                description: 'æœ‰è¡›ç”Ÿç´™',
                price: 'å…è²»',
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                position: {
                    lat: 37.44440882321596,
                    lng: -122.2160620727
                }
            }, ];

            // è‡ªå®šç¾©å»æ‰€ä½ç½®è³‡æ–™
            const bathroomLocations = [{
                position: {
                    lat: 25.035203792858603,
                    lng: 121.38892855558247
                },
                title: "é•·åºšå¤§å­¸ç®¡ç†å­¸é™¢å·¦å´",
                description: "  ",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸ç®¡ç†å­¸é™¢å·¦å´",
            }, {
                position: {
                    lat: 25.034778046301682,
                    lng: 121.38966132703302
                },
                title: "é•·åºšå¤§å­¸ç®¡ç†å­¸é™¢å³å´",
                description: "B1-8Fçš†æœ‰å»æ‰€",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸ç®¡ç†å­¸é™¢å³å´",
            }, {
                position: {
                    lat: 25.035389730885495,
                    lng: 121.38798704644645
                },
                title: "é•·åºšå¤§å­¸ç¬¬äºŒé†«å­¸å¤§æ¨“",
                description: "  ",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸ç¬¬äºŒé†«å­¸å¤§æ¨“",
            }, {
                position: {
                    lat: 25.03524457986946,
                    lng: 121.38743095319201
                },
                title: "é•·åºšå¤§å­¸ç¬¬äºŒé†«å­¸å¤§æ¨“",
                description: "  ",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸ç¬¬äºŒé†«å­¸å¤§æ¨“",
            }, {
                position: {
                    lat: 25.034691558025745,
                    lng: 121.38811314280024
                },
                title: "å°å¡‘ä¼æ¥­æ–‡ç‰©é¤¨",
                description: " ",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "å°å¡‘ä¼æ¥­æ–‡ç‰©é¤¨",
            }, {
                position: {
                    lat: 25.034199986555958,
                    lng: 121.38936308994995
                },
                title: "é•·åºšå¤§å­¸ç¬¬ä¸€é†«å­¸å¤§æ¨“å·¦å´",
                description: "  ",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸ç¬¬ä¸€é†«å­¸å¤§æ¨“å·¦å´",
            }, {
                position: {
                    lat: 25.03390231816379,
                    lng: 121.38997322046629
                },
                title: "é•·åºšå¤§å­¸ç¬¬ä¸€é†«å­¸å¤§æ¨“å³å´",
                description: "  ",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸ç¬¬ä¸€é†«å­¸å¤§æ¨“å³å´",
            }, {
                position: {
                    lat: 25.0339221627409,
                    lng: 121.39058335105165
                },
                title: "é•·åºšå¤§å­¸å·¥å­¸å¤§æ¨“",
                description: " ",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸å·¥å­¸å¤§æ¨“",
            }, {
                position: {
                    lat: 25.03355078503238,
                    lng: 121.39027046360735
                },
                title: "é•·åºšå¤§å­¸å·¥å­¸å¤§æ¨“",
                description: "  ",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸å·¥å­¸å¤§æ¨“",
            }, {
                position: {
                    lat: 25.0327597789661,
                    lng: 121.39067756957628
                },
                title: "é•·åºšå¤§å­¸å­¸ç”Ÿæ´»å‹•ä¸­å¿ƒ",
                description: "1F-3Fçš†æœ‰å»æ‰€",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸å­¸ç”Ÿæ´»å‹•ä¸­å¿ƒ",
            }, {
                position: {
                    lat: 25.03178281120947,
                    lng: 121.39057564565948
                },
                title: "é•·åºšå¤§å­¸å­¸ç”Ÿæ´»å‹•ä¸­å¿ƒ1F",
                description: "åå»šæ—",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸å­¸ç”Ÿæ´»å‹•ä¸­å¿ƒ1F",
            }, {
                position: {
                    lat: 25.034472949940255,
                    lng: 121.39161994608558
                },
                title: "é•·åºšå¤§å­¸æ“šå¾·æ¨“",
                description: "éœ€è¦åˆ·å¡é€²å…¥",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸æ“šå¾·æ¨“",
            }, {
                position: {
                    lat: 25.03594448294653,
                    lng: 121.38981020937634
                },
                title: "é•·åºšå¤§å­¸æ˜å¾·æ¨“",
                description: "éœ€è¦åˆ·å¡é€²å…¥",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸æ˜å¾·æ¨“",
            }, {
                position: {
                    lat: 25.032448268379383,
                    lng: 121.39235633553956
                },
                title: "é•·åºšå¤§å­¸è˜Šå¾·æ¨“",
                description: "éœ€è¦åˆ·å¡é€²å…¥",
                price: "å…è²»",
                type: 'toilet',
                bed: 0,
                bath: 1,
                size: 10,
                address: "é•·åºšå¤§å­¸è˜Šå¾·æ¨“",
            }, ];

            const allToiletLocations = [...toiletLocations, ...bathroomLocations];

            // å‰µå»ºæ¨™è¨˜çš„å‡½æ•¸
            function createMarkers(map, locations) {
                for (const toilet of locations) {
                    const marker = new google.maps.marker.AdvancedMarkerElement({
                        map: map,
                        content: buildContent(toilet),
                        position: toilet.position,
                        title: toilet.title,
                    });

                    // æ·»åŠ é»æ“Šäº‹ä»¶ï¼Œé¡¯ç¤ºè³‡è¨Šè¦–çª—
                    const infowindow = new google.maps.InfoWindow({
                        content:
                            `<div><strong>${toilet.title}</strong><br>åœ°å€: ${toilet.address}<br>æè¿°: ${toilet.description}</div>`,
                    });

                    marker.addListener("click", () => {
                        infowindow.open(map, marker);
                    });
                }
            }

            // Function to find nearby toilets using Google Maps Places API
            function findNearbyToilets(map, position) {
                const service = new google.maps.places.PlacesService(map);
                const request = {
                    location: position,
                    radius: 500, // Search within 500 meters
                    type: ['toilet']
                };

                service.nearbySearch(request, (results, status) => {
                    if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                        for (let i = 0; i < results.length; i++) {
                            createToiletMarker(map, results[i]);
                        }
                    }
                });
            }

            // Function to create a marker for a toilet found using the Places API
            function createToiletMarker(map, place) {
                const marker = new google.maps.marker.AdvancedMarkerElement({
                    map: map,
                    position: place.geometry.location,
                    title: place.name,
                    content: buildContent({
                        address: place.vicinity || place.formatted_address || 'N/A',
                        description: 'Google Maps æ‰¾åˆ°çš„å»æ‰€',
                        price: 'å…è²»',
                        type: 'toilet',
                        bed: 0,
                        bath: 1,
                        size: 10
                    })
                });

                // Add click event to show info window
                const infowindow = new google.maps.InfoWindow({
                    content:
                        `<div><strong>${place.name}</strong><br>åœ°å€: ${place.vicinity || place.formatted_address || 'N/A'}<br>ä¾†æº: Google Maps</div>`
                });

                marker.addListener("click", () => {
                    infowindow.open(map, marker);
                });
            }


            // ä½¿ç”¨è€…å®šä½
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };

                        map.setCenter(pos);
                        map.setZoom(15);

                        // åœ¨å®šä½å¾Œæ·»åŠ ä½¿ç”¨è€…ä½ç½®æ¨™è¨˜
                        const userMarker = new google.maps.marker.AdvancedMarkerElement({
                            map: map,
                            position: pos,
                            content: createUserLocationMarker(), // User location marker
                        });

                        // **[é‡è¦]** åœ¨é€™è£¡å‘¼å« findNearbyToiletsï¼Œä»¥è§¸ç™¼ Places API æœå°‹
                        findNearbyToilets(map, pos);
                        createMarkers(map, allToiletLocations);
                    },
                    (error) => {
                        console.error("ğŸ“ åœ°ç†å®šä½éŒ¯èª¤:", error.message);
                        alert("âŒ ç„¡æ³•å–å¾—æ‚¨çš„ä½ç½®ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");

                        // å¦‚æœå®šä½å¤±æ•—ï¼Œä½¿ç”¨é è¨­ä½ç½®
                        map.setCenter({
                            lat: 37.43238031167444,
                            lng: -122.16795397128632
                        });
                        map.setZoom(11);
                        findNearbyToilets(map, {
                            lat: 37.43238031167444,
                            lng: -122.16795397128632
                        });

                        createMarkers(map, allToiletLocations);
                    }
                );
            } else {
                alert("âŒ æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´åœ°ç†å®šä½åŠŸèƒ½ï¼");

                // å¦‚æœä¸æ”¯æ´å®šä½ï¼Œä½¿ç”¨é è¨­ä½ç½®
                map.setCenter({
                    lat: 37.43238031167444,
                    lng: -122.16795397128632
                });
                map.setZoom(11);
                findNearbyToilets(map, {
                    lat: 37.43238031167444,
                    lng: -122.16795397128632
                });
                createMarkers(map, allToiletLocations);
            }
        }

        function toggleHighlight(markerView, property) {
            if (markerView.content.classList.contains("highlight")) {
                markerView.content.classList.remove("highlight");
                markerView.zIndex = null;
            } else {
                markerView.content.classList.add("highlight");
                markerView.zIndex = 1;
            }
        }

        function buildContent(property) {
            const content = document.createElement("div");
            content.classList.add("property");
            content.innerHTML = `
    <div class="icon">
      <i aria-hidden="true" class="fa fa-toilet fa-lg" title="${property.type}" style="color: var(--toilet-color);"></i>
      <span class="fa-sr-only">${property.type}</span>
    </div>
    <div class="details">
      <div class="price">${property.price}</div>
      <div class="address">${property.address}</div>
      <div class="features">
        <div>
          <i aria-hidden="true" class="fa fa-bed fa-lg bed" title="${property.type}" style="color: var(--toilet-color);"></i>
          <span class="fa-sr-only">bedroom</span>
          <span>${property.bed}</span>
        </div>
        <div>
          <i aria-hidden="true" class="fa fa-bath fa-lg bath" title="${property.type}" style="color: var(--toilet-color);"></i>
          <span class="fa-sr-only">bathroom</span>
          <span>${property.bath}</span>
        </div>
        <div>
          <i aria-hidden="true" class="fa fa-ruler fa-lg size" title="${property.type}" style="color: var(--toilet-color);"></i>
          <span class="fa-sr-only">size</span>
          <span>${property.size} ft<sup>2</sup></span>
        </div>
      </div>
    </div>
  `;
            return content;
        }

        // Custom user location marker
        function createUserLocationMarker() {
            const userLocation = document.createElement("div");
            userLocation.className = "user-location";
            return userLocation;
        }

        window.initMap = initMap;

        // éåŒæ­¥åŠ è¼‰ Google Maps API
        const script = document.createElement('script');
        script.src =
            "https://maps.googleapis.com/maps/api/js?key=my_key&callback=initMap&libraries=marker,maps,places";
        script.async = true;
        document.head.appendChild(script);
    </script>
    <style>
        /* ä¸»è¦å…§å®¹å€å¡Š */
        .main-content {
            display: flex;
            /* å½ˆæ€§ç›’æ¨¡å‹ */
            justify-content: center;
            /* è®“å…§å®¹æ°´å¹³ç½®ä¸­ */
            align-items: center;
            /* è®“å…§å®¹å‚ç›´ç½®ä¸­ */
            flex-direction: column;
            /* å…§å®¹å‚ç›´æ’åˆ— */
            width: 100%;
            /* ç¢ºä¿å€å¡Šå¡«æ»¿çˆ¶å®¹å™¨ */
            min-height: 500px;
            /* è¨­å®šå…§å®¹å€åŸŸçš„æœ€å°é«˜åº¦ */
            margin-top: 100px;
            /* è®“åœ°åœ–èˆ‡ header ä¿æŒè·é›¢ */
            padding: 20px;
            /* é¿å…å…§å®¹ç·Šè²¼é‚Šç•Œ */
        }

        /* åœ°åœ–å®¹å™¨ */
        #map-container {
            width: 80%;
            /* è¨­å®šåœ°åœ–å¯¬åº¦ */
            max-width: 800px;
            /* é™åˆ¶æœ€å¤§å¯¬åº¦ */
            height: 500px;
            /* è¨­å®šå›ºå®šé«˜åº¦ */
            margin: auto;
            /* è®“åœ°åœ–æ°´å¹³ç½®ä¸­ */
            border: 1px solid #ddd;
            /* å¢åŠ é‚Šæ¡† */
            border-radius: 10px;
            /* åœ“è§’é‚Šæ¡† */
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            /* é™°å½±æ•ˆæœ */
            overflow: hidden;
            /* é˜²æ­¢å…§å®¹æº¢å‡º */
        }

        /* ğŸ”¹ RWDï¼šå°è¢å¹•æ™‚è®“åœ°åœ–é©æ‡‰ */
        @media (max-width: 768px) {
            .main-content {
                margin-top: 120px;
                /* æ‰‹æ©Ÿç‰ˆå¢åŠ é–“è· */
            }

            #map-container {
                width: 95%;
                /* æ‰‹æ©Ÿç‰ˆè®“åœ°åœ–æ›´å¯¬ */
                height: 400px;
                /* é¿å…åœ°åœ–éé«˜ */
            }
        }
    </style>
</body>

</html>
